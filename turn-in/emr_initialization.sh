#!/bin/bash
export AWS_ACCESS_KEY_ID=ASIASKM4G45MCNSYPAGD
export AWS_SECRET_ACCESS_KEY=O2nzu4GgPdREiODwaNuEFB6ORXZ2npzvWvghORvx
export AWS_SESSION_TOKEN=FwoGZXIvYXdzEOn//////////wEaDAraPHoTa5LUE1km+SKqAZnrVm0fMHG5gE/V7imcQ6A5Y+bkGaeKkfw7X1MrETCJP33cHSy4rw87FUBRSQ86glso95HB/HBnnQ/IqWw8CE3HROCYPNIgsqBJPcc3T8JMsw3lkh7st/5LdAkmw3InrXsugJdDBLsiLwyeiC7sLUIstw8erNhxf2bRmZ5iPzDeBG96sMEoBNTccaVK7lUqRpGYxJSvxx1kviSw9Uki5llGwa5AGzEgKGKDKLigy4UGMi31I2XrWwkU9wl83/nVfz+VnF1pKIBLcInQZsQGqBkSyX1zzDo4bWlH1Nm3Up0=

aws emr create-cluster --name "cluster" --applications Name=Hadoop Name=Hive Name=Pig Name=Hue Name=Spark --ec2-attributes '{"KeyName":"colin_key","InstanceProfile":"EMR_EC2_DefaultRole"}' --release-label emr-6.3.0 --log-uri 's3n://aws-logs-cluster-us-west-2/elasticmapreduce/' --instance-type m5.xlarge --instance-count 2 --configurations '[{"Classification":"spark-hive-site","Properties":{"hive.metastore.client.factory.class":"com.amazonaws.glue.catalog.metastore.AWSGlueDataCatalogHiveClientFactory"}}]' --auto-scaling-role EMR_AutoScaling_DefaultRole --ebs-root-volume-size 10 --service-role EMR_DefaultRole --enable-debugging --scale-down-behavior TERMINATE_AT_TASK_COMPLETION --steps Type=Spark,Name="Spark application",ActionOnFailure=CONTINUE,Args=[--deploy-mode,cluster,--master,yarn,s3://ds102-dsc01-scratch/label_prep.py] Type=Spark,Name="Spark application",ActionOnFailure=CONTINUE,Args=[--deploy-mode,cluster,--master,yarn,s3://ds102-dsc01-scratch/model.py] --region us-west-2 --auto-terminate